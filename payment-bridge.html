<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DEBUG – UMA Payment Bridge</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    h2 { color: #333; }
    pre { background: #eee; padding: 15px; border-radius: 5px; font-size: 16px; }
    .info { margin-bottom: 20px; }
    .note { color: #555; font-size: 14px; }
</style>
</head>
<body>

<h2>DEBUG MODE – Data That Will Be Sent to UMA TPV</h2>
<p class="note">Check all fields below. If any are empty or malformed, UMA may reject the request.</p>

<div class="info">
    <pre id="debug"></pre>
</div>

<form id="paymentForm" method="POST" action="https://tpv.uma.es/icafr-2025/" style="display:none;">
    <input type="hidden" name="amount" id="amount">
    <input type="hidden" name="payment_concept" id="payment_concept">
    <input type="hidden" name="full_name" id="full_name">
    <input type="hidden" name="document_id" id="document_id">
</form>

<script>
console.log("Debug bridge loaded.");

// Read URL parameters
const urlParams = new URLSearchParams(window.location.search);

// Decode parameters for display
const amount      = urlParams.get('amount');
const concept     = decodeURIComponent(urlParams.get('payment_concept') || '');
const fullName    = decodeURIComponent(urlParams.get('full_name') || '');
const documentId  = decodeURIComponent(urlParams.get('document_id') || '');

// Fill hidden form for submission
document.getElementById('amount').value = amount;
document.getElementById('payment_concept').value = concept;
document.getElementById('full_name').value = fullName;
document.getElementById('document_id').value = documentId;

// Display values nicely for debug (no %20)
document.getElementById('debug').textContent =
    "amount: " + amount + "\n" +
    "payment_concept: " + concept + "\n" +
    "full_name: " + fullName + "\n" +
    "document_id: " + documentId + "\n\n" +
    "The form will auto-submit in 10 seconds...";

console.log("Debug output:", { amount, concept, fullName, documentId });

// Auto-submit after 10 seconds
setTimeout(() => {
    console.log("Submitting to UMA TPV...");
    document.getElementById('paymentForm').submit();
}, 10000);
</script>

</body>
</html>
